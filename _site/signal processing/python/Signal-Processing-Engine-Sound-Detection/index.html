<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.22.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Signal Processing - Engine Sound Detection - Econometrics &amp; Data Science</title>
<meta name="description" content="Detecting the engine-brand from a Formula 1 car by its sound using Neural Networks">


  <meta name="author" content="Paul Mora">
  
  <meta property="article:author" content="Paul Mora">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Econometrics & Data Science">
<meta property="og:title" content="Signal Processing - Engine Sound Detection">
<meta property="og:url" content="http://localhost:4000/signal%20processing/python/Signal-Processing-Engine-Sound-Detection/">


  <meta property="og:description" content="Detecting the engine-brand from a Formula 1 car by its sound using Neural Networks">



  <meta property="og:image" content="http://localhost:4000/assets/article_images/signal/cover1.gif">





  <meta property="article:published_time" content="2020-08-24T00:00:00+02:00">





  

  


<link rel="canonical" href="http://localhost:4000/signal%20processing/python/Signal-Processing-Engine-Sound-Detection/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Paul Mora",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Econometrics & Data Science Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Econometrics & Data Science
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/">Blog</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero"
  style=" background-image: url('');"
>
  
    <img src="/assets/article_images/signal/cover1.gif" alt="Signal Processing - Engine Sound Detection" class="page__hero-image">
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/general_images/author.jpg" alt="Paul Mora" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Paul Mora</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Econometrician &amp; Data Scientist at STATWORX</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Germany</span>
        </li>
      

      
        
          
            <li><a href="mailto:paul.michael.mora.sancho@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://github.com/data4help" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/paul-mora-53a727168/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Signal Processing - Engine Sound Detection">
    <meta itemprop="description" content="Detecting the engine-brand from a Formula 1 car by its sound using Neural Networks">
    <meta itemprop="datePublished" content="2020-08-24T00:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Signal Processing - Engine Sound Detection
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          20 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p><em>Detecting the engine-brand from a Formula 1 car by its sound using Neural Networks</em></p>

<p>Formula 1 is not everybody’s cup of tea. Whereas some celebrate risky takeover maneuvers, others only see dangerous driving in spaceship-looking vehicles. One particularly divisive aspect of the sport is the incredibly loud and distinct noise made by the cars. Even though the FIA banned the infamously loud V12 in the year 2000, Formula 1 cars are not known to go by unnoticed.</p>

<p>For many opponents of the sport all engines sound the same. But do they really? This project tries to predict the engine-brand using sound data.</p>

<h2 id="overview">Overview</h2>

<p>This blogpost elaborates on how to build a sound-recognition model from scratch using a Neural Network. Given that we need to process audio data before the Neural Network can be trained on it, several sound concepts and terminology are introduced to give the reader a better understanding.</p>

<p>The post starts by elaborating on where from and how the data was collected. Afterwards, we cover some audio-related terminology before diving into the practical implementation of signal processing in Python.</p>

<p>After the bulk-processing of the audio data is conducted, we focus our attention onto the implementation of the neural network using tensorflow. As the last step we then implement our prediction onto some test-data and create a montage video, which is also used as the title image of this blogpost.</p>

<h2 id="data-collection">Data Collection</h2>

<p>In order to build a model that predicts which sound belongs to which engine, we need labelled sound-data. Labelling means we know which engine-brand produced which sound.</p>

<p>Obtaining Formula 1 content proved to be relatively easy through their official Youtube Channel. <a href="https://medium.com/r/?url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DkmuKQ2JQK30%26list%3DPLfoNZDHitwjUA9aqbPGKw1l4SIz2bACi_">Here we find a compilation of videos labelled Pole Laps</a>. Before each race in Formula 1, as in every other motorsport, every driver undergoes a procedure called Qualifying where each driver tries to complete the track in the shortest possible time. The person who wins this competition gets rewarded with the Pole Position. This term, which originates from horse racing, describes the most favorable position a driver can think off for the actual race - namely starting from the very front.</p>

<p>Given that the lap which sets the quickest time, the so called Pole Lap, is interesting to watch for many, the official Formula 1 channel uploaded an on-board video taken from the care from this lap for every race. Below we find a compilation of short snippets from these videos.</p>

<p>We use these qualifying lap videos as they contain only one car, making the sounds data pure. In the actual race where many cars are driving, it would be much more difficult to identify and separate out the individual sounds of each engine.</p>

<p><img src="/assets/post_images/signal/picture1.png" alt="Copyright: Formula One Management, Sky Sports" /></p>

<p>Next to be very entertaining to watch, these videos are particularly useful for our task. That is because the data is labelled (we know which engine-brand is driving in which video) and the data is relatively free from any noise.</p>

<p>Furthermore, in the racing year 2019 two engine-brands were taking turns in winning the Qualifying - Ferrari and Mercedes. To be exact, out of 21 Qualifying, Mercedes and Ferrari won 10 and 9 of these, respectively.</p>

<p>Since we are solely interested in the sound of these videos we extract the sound information from these 19 videos and save them in a wav-format.</p>

<p><img src="/assets/post_images/signal/picture2.png" alt="Raw audio files" /></p>

<h2 id="sound-data-firststeps">Sound Data - First Steps</h2>

<p>The processing of sound data might be a bit unfamiliar for some, therefore the following section explains the fundamentals of sound data.</p>

<p>We’ll start by answering the first fundamental question - what is sound? Sound could be described as simply the vibration of an object. The vibrations then cause the oscillation of air molecules. We can hear this sound as soon as these vibrations hit our ear.</p>

<p>Sound is a continuous variable, meaning that we have an infinite amount of information, or data points, per second. This actually represents a bit of a problem when trying to store that information - we have to turn this continuous signal into a discrete one. That process is called Analog to digital conversion (ADC).</p>

<p>ADC does two things: first, it samples the sound information, and second, it quantifies the information at each sampling point. The sampling frequency is measured in hertz and describes how often we would like to store sound information per second. The more samples we take within a second, the smaller the overall loss of information. That does not mean though that a higher sampling rate is always better though. A classical CD has around 22,050 hertz. The reason for this seemingly arbitrary number is the hearing range for humans, which is around 20,000 hertz. Hence, for humans the sampling rate of a CD is more than sufficient to appreciate the sound.</p>

<p>After knowing how often we would like to sample per second we should talk about what exactly we store. Here the term quantization comes into play. Quantization assigns a value to each sound signal we extract. Given that sound information has a continuous value and we have to store that information in a discrete way for a computer to store it. For example, if the signal has a value of 2.234253243… (meaning a never ending number), we will round to e.g. 2.23. This, of course, leads to some sort of a rounding error. How high this error is depends on the resolution of the sound. This resolution is measured in bits (also referred to as bit depth). A CD has a bit depth of 16, which is sufficiently high for the human ear.</p>

<h2 id="wave-plots-and-related-terminology">Wave-plots and related Terminology</h2>
<p>After covering how sound-information is stored, it is now time to talk about how the actual processing of sound-information works. We start by introducing the probably most common sound-visualization - the wave-plot.</p>

<p><img src="/assets/post_images/signal/picture3.png" alt="Single Sine-wave" /></p>

<p>A wave-plot displays the sound-signal as a function of time. Technically put, a wave-plot shows the deviation of the zero-line in air pressure. A wave-form, even though looking relatively simple, carries a lot of further relevant information like frequency, amplitude, intensity and timbre of the sound. These attributes shape how exactly the wave-plot looks.</p>

<p>These additional attributes in the wave-plot are extremely important for understanding sound, so we’ll look at them more closely and explain their meaning. Frequency is the inverse of the amount of time that elapses between two peaks of a soundwave, called periods. The graph below illustrates that concept, where f denotes the frequency and T the time of a period. Overall, a higher frequency leads to a higher-pitched sound, whereas a lower frequency leads to a lower/ deeper sound. Unlike the graphic below, most sounds in real-life are not that nice and easy. Most of the time we face a so called aperiodic sound, which consists out of many different frequencies laying on top of each other.</p>

<p><img src="/assets/post_images/signal/picture4.png" alt="Source: https://www.investopedia.com" /></p>

<p>Amplitude, on the other hand, quantifies the perturbation of the air pressure. A higher perturbation signifies more energy being transmitted through the soundwave. This results in a louder sound. A low amplitude results then, consequently, in a more quite sound.</p>

<p><img src="/assets/post_images/signal/picture5.png" alt="Source: https://www.investopedia.com" /></p>

<p>Intensity is formally measured in sound power per unit area. Given the incredibly large range of sounds that a human ear is able to hear, this variable uses a logarithmic scale. Furthermore, it is important to know that this variable is measured in decibels. Below we find a table which gives us some sort of indication about the magnitude of decibels. Our Formula 1 car has an intensity of 140 decibels and is therefore relatively close to the threshold of permanent hearing damage.</p>

<p><img src="/assets/post_images/signal/picture6.png" alt="" /></p>

<p>The last concept of importance is called timbre. This variable is probably the most abstract concept we encountered so far. It is normally described as the color of the sound. It describes the difference in sound holding frequency, intensity and duration constant. The importance of the variable becomes clear when trying to distinguish a trumpet and a violin which play the exact same sound. It is exactly this variable which will play a crucial role within our task of identifying the engine-brand.</p>

<p>After covering the most important concepts of sound, it is now time to take a look at our data by building wave-plots. We start by building one sound-wave for each engine-brand, meaning one for Ferrari and one for Mercedes.</p>

<p>We start by importing all the relevant packages and defining the paths on our computer. Furthermore, we build a dictionary which specifies the location of the two audio files and the color we would like to draw them in.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Packages
</span><span class="kn">import</span> <span class="nn">librosa</span><span class="p">,</span> <span class="n">librosa</span><span class="p">.</span><span class="n">display</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c1"># Paths
</span><span class="n">main_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s">"/Users/paulmora/Documents/projects/formula"</span>
<span class="n">raw_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s">"{}/00 Raw"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">main_path</span><span class="p">)</span>
<span class="n">code_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s">"{}/01 Code"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">main_path</span><span class="p">)</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s">"{}/02 Data"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">main_path</span><span class="p">)</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s">"{}/03 Output"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">main_path</span><span class="p">)</span>

<span class="c1"># Specifying plotting information
</span><span class="n">dict_examples</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"ferrari"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">"file"</span><span class="p">:</span> <span class="sa">r</span><span class="s">"{}/ferrari/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">raw_path</span><span class="p">,</span> <span class="s">"f_austria.wav"</span><span class="p">),</span>
        <span class="s">"color"</span><span class="p">:</span> <span class="s">"red"</span>
    <span class="p">},</span>
    <span class="s">"mercedes"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">"file"</span><span class="p">:</span> <span class="sa">r</span><span class="s">"{}/mercedes/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">raw_path</span><span class="p">,</span> <span class="s">"m_australia.wav"</span><span class="p">),</span>
        <span class="s">"color"</span><span class="p">:</span> <span class="s">"silver"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>When importing the sound file we have to specify the sample rate. As discussed in the beginning of the blog-post, a Sample Rate of 22,050 hertz is more than sufficient.</p>

<p>The go-to sound processing package in Python is called librosa. This package has a handy command for calculating and plotting the wave-plot.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">SR</span> <span class="o">=</span> <span class="mi">22_050</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="p">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">team</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dict_examples</span><span class="p">):</span>
    <span class="n">signal</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">dict_examples</span><span class="p">[</span><span class="n">team</span><span class="p">][</span><span class="s">"file"</span><span class="p">],</span> <span class="n">sr</span><span class="o">=</span><span class="n">SR</span><span class="p">)</span>
    <span class="n">dict_examples</span><span class="p">[</span><span class="n">team</span><span class="p">][</span><span class="s">"signal"</span><span class="p">]</span> <span class="o">=</span> <span class="n">signal</span>
    <span class="n">librosa</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">waveplot</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">],</span>
                             <span class="n">color</span><span class="o">=</span><span class="n">dict_examples</span><span class="p">[</span><span class="n">team</span><span class="p">][</span><span class="s">"color"</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="n">team</span><span class="p">,</span> <span class="p">{</span><span class="s">"fontsize"</span><span class="p">:</span><span class="mi">18</span><span class="p">})</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">"both"</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"Amplitude"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"Time"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">"{}/waveplot.png"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">output_path</span><span class="p">),</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s">"tight"</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/post_images/signal/picture7.png" alt="Ferrari Audio File: https://www.youtube.com/watch?v=3KJGKeW1FoY // Mercedes Audio File: https://www.youtube.com/watch?v=fnUZFrrd9os" /></p>

<p>Listening to one of the videos, one quickly notices that the engine is as its loudest when driven full-speed. This, probably not very noble finding, explains the aperiodic behavior of the wave-plots above. It is likely that every systematical temporary drop in amplitude is due to a time when the car slowed down a.k.a when facing a corner.</p>

<p>Looking at the two plots above it looks like the Ferrari engine is significantly louder than the Mercedes engine. It would be important to check whether that is a systematic finding, or whether a specific one. For that reason we plotted the wave-plots for all races.</p>

<p><img src="/assets/post_images/signal/picture8.png" alt="Red wave plots: Ferrari Engine // Gray wave plots: Mercedes Engine // Green wave plots: Compilation of both engines" /></p>

<p>The plot above shows us that identifying which engine-brand a sound belongs is not as easy as just looking for the higher amplitude/ louder sound. The plot tells us that whether a sound is relatively loud or quite is somewhat random and not specific to an individual engine.</p>

<p>The pondering question now is what we can learn from the wave-plots we saw before. Even though a wave-plot captures a lot of information, most of it is not entirely visible to us at that point. As the next step we will take a deeper look into the different frequencies of our sound. This is done by using a so-called Fourier Transform.</p>

<h2 id="fourier-transform">Fourier Transform</h2>
<p>A Fourier Transform describes the method of decomposing complex sounds into a sum of sine waves, oscillating at different frequencies. To understand what that means, it is important to acknowledge that every complex sound (e.g. not a simple sine wave) consists out of a sum of many smaller sounds.</p>

<p><img src="/assets/post_images/signal/picture9.png" alt="Source: https://dev.to/trekhleb/playing-with-discrete-fourier-transform-algorithm-in-javascript-53n5" /></p>

<p>The Fourier Transform is particularly interested in the amplitude of each frequency. That is because the amplitude tells us the magnitude by how much a specific frequency contributes to the overall complex sound.</p>

<p>A good comparison to understand that context better would be the creation of a cooking sauce. A sauce has a certain taste which is driven by its different ingredients. In the beginning it might seem very difficult to tell which and by how much each spice is contributing to the overall taste. A Fourier Transform tells us exactly that. It splits up the sauce into the different components and tells us how much of which spice was used to create the overall sauce and taste.</p>

<p>Coming back to our Formula 1 car-sound example. When applying a Fourier Transform on our sound information from before, we end up with the following two, so called, power-spectrum. The code below shows how to create the power-spectrums for our problem:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="p">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">team</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dict_examples</span><span class="p">):</span>
    <span class="c1"># Calculating the fourier transform
</span>    <span class="n">signal</span> <span class="o">=</span> <span class="n">dict_examples</span><span class="p">[</span><span class="n">team</span><span class="p">][</span><span class="s">"signal"</span><span class="p">]</span>
    <span class="n">fft</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="n">fft</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
    <span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">fft</span><span class="p">)</span>
    <span class="n">frequency</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">magnitude</span><span class="p">))</span>
    <span class="n">left_frequency</span> <span class="o">=</span> <span class="n">frequency</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
    <span class="n">left_magnitude</span> <span class="o">=</span> <span class="n">magnitude</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
<span class="c1"># Plotting results
</span>    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">left_frequency</span><span class="p">,</span> <span class="n">left_magnitude</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="n">team</span><span class="p">,</span> <span class="p">{</span><span class="s">"fontsize"</span><span class="p">:</span><span class="mi">18</span><span class="p">})</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">"both"</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"Magnitude"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"Frequency"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">left_frequency</span><span class="p">,</span> <span class="n">left_magnitude</span><span class="p">,</span>
                  <span class="n">color</span><span class="o">=</span><span class="n">dict_examples</span><span class="p">[</span><span class="n">team</span><span class="p">][</span><span class="s">"color"</span><span class="p">])</span>
<span class="n">fig</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">"{}/powerspectrum.png"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">output_path</span><span class="p">),</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s">"tight"</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/post_images/signal/picture10.png" alt="Power Spectrum for the Ferrari Engine (left) and Mercedes Engine (right)" /></p>

<p>The plots above show us the Magnitude as a function of Frequency. We can see that the main sound for a F1 car is to be found in the lower levels of frequency.</p>

<p>A power-spectrum has one central weakness. Namely, the loss of the time domain. A power-spectrum shows us which frequency drives the overall sound, for the entire soundtrack. That static behavior, of course, a problem since music is a time series and changes over time are crucial.</p>

<p>The solution to that problem is something called a Short Time Fourier Transform which is explained in the next section.</p>

<h2 id="short-time-fourier-transform">Short Time Fourier Transform</h2>

<p>In order to fight the static behavior of the power-spectrum, a dynamic version is created, namely a Short Time Fourier Transform (STFT). A STFT computes several Fourier Transforms at different intervals. This has the benefit that the time information is persevered without losing any of the benefits of a regular Fourier Transform.</p>

<p>To apply a Short Fourier Transform in Python we need to specify several variables, namely the n_fft and the hop_length. The n_fft denotes the number of samples for number of samples we use to calculate each Fourier Transform. It can be regarded as the size of the moving window over time. The hop_length, on the other hand, denotes how much we shift to the right after conducting one Fourier Transform. The common values for these variables are 2048 and 512 samples, respectively.</p>

<p>A STFT results in something called a spectogram, which is an important concept within the realm of signal processing, as it compromises information about time (x-axis), frequency (y-axis) and magnitude of sound (color). The following code shows how to implement such a STFT for our example.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n_fft</span> <span class="o">=</span> <span class="mi">2048</span>  <span class="c1"># Window for single fourier transform
</span><span class="n">hop_length</span> <span class="o">=</span> <span class="mi">512</span>  <span class="c1"># Amount for shifting to the right
</span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="p">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">team</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dict_examples</span><span class="p">):</span>
    <span class="n">signal</span> <span class="o">=</span> <span class="n">dict_examples</span><span class="p">[</span><span class="n">team</span><span class="p">][</span><span class="s">"signal"</span><span class="p">]</span>
    <span class="n">stft</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">stft</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">,</span> 
                             <span class="n">n_fft</span><span class="o">=</span><span class="n">n_fft</span><span class="p">)</span>
    <span class="n">spectogram</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">stft</span><span class="p">)</span>
    <span class="n">log_spectogram</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">amplitude_to_db</span><span class="p">(</span><span class="n">spectogram</span><span class="p">)</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">specshow</span><span class="p">(</span><span class="n">log_spectogram</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
                                    <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">,</span> 
                                    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">"both"</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="n">team</span><span class="p">,</span> <span class="p">{</span><span class="s">"fontsize"</span><span class="p">:</span><span class="mi">18</span><span class="p">})</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"Frequency"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"Time"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
<span class="n">cb</span><span class="p">.</span><span class="n">ax</span><span class="p">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">r</span><span class="s">"{}/short_fourier.png"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">output_path</span><span class="p">),</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s">"tight"</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/post_images/signal/picture11.png" alt="Spectogram for Ferrari Engine sound (left) and Mercedes Engine sound (right)" /></p>

<p>Looking at the chart above, the benefit of the spectogram over the power-spectrum becomes apparent. Whereas in the power-spectrum we were only able to tell that the sound-piece contains strong low-frequency sounds, the spectogram can also tell us now when in time the frequencies occur.</p>

<p>For example it becomes apparent that the Mercedes Engine exhibits overall somewhat more intense higher frequencies compared to the Ferrari engine. That could be potentially helpful for the model to depict the differences.</p>

<p>The information we gathered so far provided us with a lot of insights. However, so far we do not have anything to feed into a prediction model. The next step will take care of that problem. For that we introduce the concept of MFCCs.</p>

<h2 id="mfccs">MFCCs</h2>

<p>Arguably even more important than the spectogram is the concept of the Mel Frequency Cepstral Coefficients (MFCCs). The reason for their importance is that the resulting coefficients are going to be the input values for our Deep Learning model. Therefore, it is important to gain some intuition what these factors are and what they represent.</p>

<p>The usefulness of MFCCs lies in their ability to capture timbral and textural aspects of sound. Timbre, as explained earlier in this blogpost, captures the color of the sound. Meaning the difference of sound which is not due to frequency, pitch or even amplitude. Next to that, MFCCs are, in contrast to spectrograms, able to approximate the human auditory system.</p>

<p>When calculating MFCCs we get a vector of coefficients for each time frame. The number of coefficients, as well as the time frame has to be specified in the beginning. Normally, the number of coefficients for sound-classification lies between 13–40, where we chose 13.</p>

<p>The code below shows how to implement the extraction of these MFCCs for our Formula 1 example.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="p">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">team</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dict_examples</span><span class="p">):</span>
    <span class="n">signal</span> <span class="o">=</span> <span class="n">dict_examples</span><span class="p">[</span><span class="n">team</span><span class="p">][</span><span class="s">"signal"</span><span class="p">]</span>
<span class="n">MFCCs</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="n">mfcc</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="n">n_fft</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">,</span>
                                 <span class="n">n_mfcc</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">specshow</span><span class="p">(</span><span class="n">MFCCs</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">,</span>
                                    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">"both"</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="n">team</span><span class="p">,</span> <span class="p">{</span><span class="s">"fontsize"</span><span class="p">:</span><span class="mi">18</span><span class="p">})</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"Time"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"Frequency"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
<span class="n">cb</span><span class="p">.</span><span class="n">ax</span><span class="p">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">r</span><span class="s">"{}/mfccs.png"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">output_path</span><span class="p">),</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s">"tight"</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/post_images/signal/picture12.png" alt="" /></p>

<p>The plots above visualize the extracted MFCCs from the both sound-pieces. These extracted sound-pieces are now ready to be fed into a neural network. Before doing that though, we have to bulk-process all tracks instead of only these two. The following section elaborates on the implementation of this process.</p>

<h2 id="data-processing-inbulk">Data Processing in bulk</h2>

<p>When completing the final processing of all sound pieces to be fed into the neural network, it is important to notice that we do not have to go through all steps outlined above. Since the input features for our Deep Learning model is going to be a list of MFCCs, we can directly jump to this step. In addition to the necessary packages from before, we have to import several other packages for the following steps.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Bulk processing packages
</span><span class="kn">from</span> <span class="nn">pydub</span> <span class="kn">import</span> <span class="n">AudioSegment</span>
<span class="kn">from</span> <span class="nn">pydub.utils</span> <span class="kn">import</span> <span class="n">make_chunks</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">copy</span>
</code></pre></div></div>

<p>Before being able to process every race-track we have in our data, we should step back and ask ourselves a quite fundamental question in the realm of Neural Networks. Do we have enough data? Currently we have 19 sound-pieces, ten tracks with a mercedes engine and nine tracks with a ferrari engine. It is pretty clear to say that 19 observations are not going to be sufficient for training purposes.</p>

<p>There is luckily one work-around. Namely, it is possible to chop up every audio-track into one-second long snippets of sounds. The implications of that are tremendous. An audio-piece which has a length of around e.g. 80 seconds would then result into 80 pieces. Doing that for all tracks in our dataset, results in around 1000 audio snippets for Ferrari as well as for Mercedes. The following code shows how we split the longer audio-pieces into one-second-snippets.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">raw_files</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"ferrari"</span><span class="p">:</span> <span class="sa">r</span><span class="s">"{}/ferrari"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">raw_path</span><span class="p">),</span>
    <span class="s">"mercedes"</span><span class="p">:</span> <span class="sa">r</span><span class="s">"{}/mercedes"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">raw_path</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"ferrari"</span><span class="p">,</span> <span class="s">"mercedes"</span><span class="p">,</span> <span class="s">"montage"</span><span class="p">]:</span>
    <span class="n">wav_files</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">"{}/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">raw_path</span><span class="p">,</span> <span class="n">team</span><span class="p">))</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">wav_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">file</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"."</span><span class="p">):</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="s">"{}/{}/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">raw_path</span><span class="p">,</span> <span class="n">team</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
            <span class="n">myaudio</span> <span class="o">=</span> <span class="n">AudioSegment</span><span class="p">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s">"wav"</span><span class="p">)</span>
            <span class="n">chunk_length_ms</span> <span class="o">=</span> <span class="mi">1000</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="n">make_chunks</span><span class="p">(</span><span class="n">myaudio</span><span class="p">,</span> <span class="n">chunk_length_ms</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
                <span class="n">padding</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="n">number</span> <span class="o">=</span> <span class="n">padding</span><span class="o">*</span><span class="s">"0"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">chunk_name</span> <span class="o">=</span> <span class="s">"{}_{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">".wav"</span><span class="p">,</span> <span class="nb">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">number</span><span class="p">)</span>
                <span class="n">chunk</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"{}/{}/{}.wav"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">team</span><span class="p">,</span>
                                                    <span class="n">chunk_name</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s">"wav"</span><span class="p">)</span>
</code></pre></div></div>

<p>The resulting files of this code can be seen below. Here we can see the first twelve one-second-snippets of a Ferrari sound. From the name we can also infer where the sound was recorded: on the austrian race-track.</p>

<p><img src="/assets/post_images/signal/picture13.png" alt="" /></p>

<p>Next up is now the mass-extraction of the MFCCs for each of the different one-second-snippets. In order to avoid data leakage, we put aside two audio-pieces for both engines to have a clean test-dataset for later performance assessment.</p>

<p>Furthermore, for visual purposes we build a montage video which compromises several different snippets in order to better present our model performance. The following code shows the bulk processing for all three audio segments.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s">"train"</span><span class="p">:</span> <span class="p">{</span><span class="s">"mfcc"</span><span class="p">:</span> <span class="p">[],</span> <span class="s">"labels"</span><span class="p">:</span> <span class="p">[],</span> <span class="s">"category"</span><span class="p">:</span> <span class="p">[]},</span>
     <span class="s">"test"</span><span class="p">:</span> <span class="p">{</span><span class="s">"mfcc"</span><span class="p">:</span> <span class="p">[],</span> <span class="s">"labels"</span><span class="p">:</span> <span class="p">[],</span> <span class="s">"category"</span><span class="p">:</span> <span class="p">[]},</span>
     <span class="s">"montage"</span><span class="p">:</span> <span class="p">{</span><span class="s">"mfcc"</span><span class="p">:</span> <span class="p">[]}</span>
<span class="p">}</span>
<span class="n">test_tracks</span> <span class="o">=</span> <span class="p">[</span><span class="s">"f_austria"</span><span class="p">,</span> <span class="s">"m_australia"</span><span class="p">]</span>
<span class="n">SAMPLE_RATE</span> <span class="o">=</span> <span class="mi">22050</span>
<span class="n">n_mfcc</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">n_fft</span> <span class="o">=</span> <span class="mi">2048</span>
<span class="n">hop_length</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">expected_num_mfcc_vectors</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">SAMPLE_RATE</span> <span class="o">/</span> <span class="n">hop_length</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">walk</span><span class="p">(</span><span class="n">data_path</span><span class="p">)):</span>
<span class="c1"># ensure that we are not at the root level
</span>    <span class="k">if</span> <span class="n">dirpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">data_path</span><span class="p">:</span>
<span class="c1"># save the team information
</span>        <span class="n">dirpath_components</span> <span class="o">=</span> <span class="n">dirpath</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">dirpath_components</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># looping over the wav files
</span>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">filenames</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"."</span><span class="p">):</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">signal</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">SAMPLE_RATE</span><span class="p">)</span>
<span class="c1"># extract the mfcc from the sound snippet
</span>                <span class="n">mfcc</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="n">mfcc</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> 
                                            <span class="n">n_fft</span><span class="o">=</span><span class="n">n_fft</span><span class="p">,</span>
                                            <span class="n">n_mfcc</span><span class="o">=</span><span class="n">n_mfcc</span><span class="p">,</span>
                                            <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">)</span>
                <span class="n">mfcc</span> <span class="o">=</span> <span class="n">mfcc</span><span class="p">.</span><span class="n">T</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="c1"># to ensure that all snippets have the same length
</span>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mfcc</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_num_mfcc_vectors</span><span class="p">:</span>
<span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">track</span> <span class="ow">in</span> <span class="n">f</span> <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">test_tracks</span><span class="p">]):</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">"test"</span><span class="p">][</span><span class="s">"mfcc"</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">mfcc</span><span class="p">)</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">"test"</span><span class="p">][</span><span class="s">"labels"</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">"test"</span><span class="p">][</span><span class="s">"category"</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s">"montage"</span> <span class="ow">in</span> <span class="n">f</span><span class="p">):</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">"montage"</span><span class="p">][</span><span class="s">"mfcc"</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">mfcc</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">"train"</span><span class="p">][</span><span class="s">"mfcc"</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">mfcc</span><span class="p">)</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">"train"</span><span class="p">][</span><span class="s">"labels"</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">"train"</span><span class="p">][</span><span class="s">"category"</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<span class="c1"># saving json with the results
</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"{}/processed_data.json"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">data_path</span><span class="p">),</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></div>

<p>Lets take a look on the processed data. Here we can see from left to right the captured MFCCs, the label which indicates whether it is a Ferrari or a Mercedes, and the category which leaves no doubt what is meant with a label of zero.</p>

<p><img src="/assets/post_images/signal/picture14.png" alt="From left to right: Extracted MFCCs, encoded category (label), engine-brand" /></p>

<p>The MFCC values we see on the left side on the picture above are extracted from one Fourier Transform. As mentioned before, we use a frame size of 2048 to conduct the FFT, afterwards we shift 512 samples to the right and conduct the next FFT. Given that we have 22050 samples per second, we end up with 44 Fourier Transforms, and 44 vectors containing 13 extracted coefficients each. The image below shows an excerpt of the resulting matrix.</p>

<p><img src="/assets/post_images/signal/picture15.png" alt="Snapshot of the extracted MFCCs" /></p>

<h2 id="neural-network">Neural Network</h2>

<p>Finally it is time now to build our Neural Network. We start by loading in the data we saved earlier, and split test and training data using sklearn train_test_split command. Here we assign 20% to the test data before turning to the model architecture.</p>

<p>As can be seen from the image above, every one-second audio snippet consists of a matrix. Since we cannot really feed in a matrix in its current form into a neural network we define our first layer as a flattening layer. This is not anything other than bringing the data into a 1-D format. Given that we have 13 coefficients and 44 extraction cycles, our input layer will have a length of 13 x 44 = 572</p>

<p>Afterwards, we define three hidden layers with 512, 256 and 64 neurons, respectively. We also specify a 30% dropout layer in order to prevent overfitting. Since the output is binary we specify 1 as the output dimensionality. When compiling the network we use the compiler Adam and a learning rate of 0.0001. Furthermore, given that we have a binary problem (an engine either belongs to Ferrari or Mercedes) we use binary_crossentropy as our loss function.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Importing packages
</span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">tensorflow.keras</span> <span class="k">as</span> <span class="n">keras</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="c1"># load and convert data
</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"{}/processed_data.json"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">data_path</span><span class="p">),</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">"train"</span><span class="p">][</span><span class="s">"mfcc"</span><span class="p">])</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">"train"</span><span class="p">][</span><span class="s">"labels"</span><span class="p">])</span>
<span class="c1"># turn data into train and testset
</span><span class="p">(</span><span class="n">inputs_train</span><span class="p">,</span> <span class="n">inputs_test</span><span class="p">,</span>
 <span class="n">target_train</span><span class="p">,</span> <span class="n">target_test</span><span class="p">)</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span>
                                               <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="c1"># build the network architecture
</span><span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># input layer
</span>    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Flatten</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">inputs</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                      <span class="n">inputs</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])),</span>
<span class="c1"># 1st hidden layer
</span>    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">"relu"</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">),</span>
<span class="c1"># 2nd hidden layer
</span>    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">"relu"</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">),</span>
<span class="c1"># 3rd hidden layer
</span>    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">"relu"</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">),</span>
<span class="c1"># output layer
</span>    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">"sigmoid"</span><span class="p">)</span>
<span class="p">])</span>
<span class="c1"># compiling the network
</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">optimizers</span><span class="p">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.000_1</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s">"binary_crossentropy"</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">"accuracy"</span><span class="p">])</span>
<span class="n">model</span><span class="p">.</span><span class="n">summary</span><span class="p">()</span>
<span class="c1"># train the network
</span><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">inputs_train</span><span class="p">,</span> <span class="n">target_train</span><span class="p">,</span>
                    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">inputs_test</span><span class="p">,</span> <span class="n">target_test</span><span class="p">),</span>
                    <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                    <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</code></pre></div></div>

<p>After storing our training history it is now time to look at our results over all epochs. The following code graphs the accuracy as well as the error over the epochs.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="c1"># create accuracy subplot
</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="p">.</span><span class="n">history</span><span class="p">[</span><span class="s">"accuracy"</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">"train_accuracy"</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="p">.</span><span class="n">history</span><span class="p">[</span><span class="s">"val_accuracy"</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">"test_accuracy"</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"Accuracy"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">"lower right"</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">"size"</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">"Accuracy evaluation"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">"both"</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="c1"># create error subplot
</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="p">.</span><span class="n">history</span><span class="p">[</span><span class="s">"loss"</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">"train error"</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="p">.</span><span class="n">history</span><span class="p">[</span><span class="s">"val_loss"</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">"test error"</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"Error"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">"upper right"</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">"size"</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">"Error evaluation"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">"both"</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">"{}/accuracy_error.png"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">output_path</span><span class="p">),</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s">"tight"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/post_images/signal/picture16.png" alt="" /></p>

<p>The result is pleasantly surprising. The model learns very quickly, and is nicely able to tell which sound belongs to which engine. To really test how well our models work, we have to see how they perform on data they haven’t seen before. We now apply the model on the two sound-pieces which we not used in the building of the neural network.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_inputs</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">"test"</span><span class="p">][</span><span class="s">"mfcc"</span><span class="p">])</span>
<span class="n">test_targets</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">"test"</span><span class="p">][</span><span class="s">"labels"</span><span class="p">])</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict_classes</span><span class="p">(</span><span class="n">test_inputs</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">test_targets</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
</code></pre></div></div>

<p>We assess the model’s accuracy with the code above. The accuracy is 98.79%, on the never-before-seen data, making it a very accurate predictor of engine sound.</p>

<h2 id="montage-video">Montage Video</h2>

<p>Lastly, as touched on earlier in this post, we build a small montage video which combines the sound-prediction with a visual to make the results come alive. For that we first predict the engine-brand using our priorly trained neural network. Afterwards, we store the results in a list, and replace the numeric label with a string.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">montage_inputs</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">"montage"</span><span class="p">][</span><span class="s">"mfcc"</span><span class="p">])</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict_classes</span><span class="p">(</span><span class="n">montage_inputs</span><span class="p">)</span>
<span class="n">list_pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">]</span>
<span class="n">engine_prediction</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Mercedes"</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">"Ferrari"</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_pred</span><span class="p">]</span>
</code></pre></div></div>

<p>Using the wonderful package moviepy we import the video and print the position of video (measured in seconds) and our prediction in the middle of the screen. Voila!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">moviepy.editor</span> <span class="k">as</span> <span class="n">mp</span>
<span class="n">montage</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">VideoFileClip</span><span class="p">(</span><span class="s">"{}/video/montage.mp4"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">raw_path</span><span class="p">))</span>
<span class="n">clip_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">second</span><span class="p">,</span> <span class="n">engine</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">engine_prediction</span><span class="p">)):</span>
    <span class="n">engine_text</span> <span class="o">=</span> <span class="p">(</span><span class="n">mp</span><span class="p">.</span><span class="n">TextClip</span><span class="p">(</span>
        <span class="s">"Prediction at Position {}:</span><span class="se">\n</span><span class="s">{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">second</span><span class="p">,</span> <span class="n">engine</span><span class="p">),</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'green'</span><span class="p">,</span>
        <span class="n">bg_color</span><span class="o">=</span><span class="s">"black"</span><span class="p">)</span>
        <span class="p">.</span><span class="n">set_duration</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">.</span><span class="n">set_start</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">clip_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">engine_text</span><span class="p">)</span>
<span class="n">final_clip</span> <span class="o">=</span> <span class="p">(</span><span class="n">mp</span><span class="p">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">clip_list</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">"compose"</span><span class="p">)</span>
              <span class="p">.</span><span class="n">set_position</span><span class="p">((</span><span class="s">"center"</span><span class="p">,</span> <span class="s">"center"</span><span class="p">)))</span>
<span class="n">montage</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">CompositeVideoClip</span><span class="p">([</span><span class="n">montage</span><span class="p">,</span> <span class="n">final_clip</span><span class="p">])</span>
<span class="n">montage</span><span class="p">.</span><span class="n">write_videofile</span><span class="p">(</span>
    <span class="s">"{}/video/montage_with_text.mp4"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">raw_path</span><span class="p">),</span>
    <span class="n">fps</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">codec</span><span class="o">=</span><span class="s">"mpeg4"</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/post_images/signal/picture17.gif" alt="" /></p>

<p>Sources
[1] https://www.youtube.com/watch?v=kmuKQ2JQK30&amp;list=PLfoNZDHitwjUA9aqbPGKw1l4SIz2bACi_
[2] https://www.youtube.com/channel/UCZPFjMe1uRSirmSpznqvJfQ</p>


        
      </section>

      <footer class="page__meta">
        
        


  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#python" class="page__taxonomy-item" rel="tag">Python</a><span class="sep">, </span>
    
      <a href="/categories/#signal-processing" class="page__taxonomy-item" rel="tag">Signal Processing</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-08-24T00:00:00+02:00">August 24, 2020</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Signal+Processing+-+Engine+Sound+Detection%20http%3A%2F%2Flocalhost%3A4000%2Fsignal%2520processing%2Fpython%2FSignal-Processing-Engine-Sound-Detection%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fsignal%2520processing%2Fpython%2FSignal-Processing-Engine-Sound-Detection%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fsignal%2520processing%2Fpython%2FSignal-Processing-Engine-Sound-Detection%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/image%20recognition/python/Using-Python-to-do-Your-Homework/" class="pagination--pager" title="Using Python to do Your Homework
">Previous</a>
    
    
      <a href="/portfolio/finance/python/Empirical-Evidence-to-common-Stock-Portfolio-Questions/" class="pagination--pager" title="Empirical Evidence to common Stock Portfolio Questions
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/classification/tutorial/python/Classifier-Evaluation-Methods-A-Hands-On-explanation/" rel="permalink">Classifier Evaluation Methods - A Hands-On Explanation
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          19 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description"> Accuracy/ Recall/ Precision/ Confusion Matrix/ ROC Curve/ AUC 

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/data%20journalism/web%20scraping/r/How-the-People-Really-Voted/" rel="permalink">How the People Really Voted
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description"> Why geographically correct maps show elections results inaccurately &lt;/em

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/reinforcement%20learning/python/Human-vs.-Machine-Reinforcement-Learning-in-the-Context-of-Snake/" rel="permalink">Human vs. Machine — Reinforcement Learning in the Context of Snake
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">This blogpost elaborates on how to implement a reinforcement algorithm, which not only masters the game “Snake”, it even outperforms any human in a game with...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/data%20journalism/r/United-for-30-Years-Catching-up-to-West-Germany/" rel="permalink">United for 30 Years — Catching up to West Germany
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          14 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description"> Visualizing 30 years of economic data between East and West Germany 

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><div class="search-searchbar"></div>
  <div class="search-hits"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://github.com/data4help" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Paul Mora. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>


<!-- Including InstantSearch.js library and styling -->
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css">

<script>
// Instanciating InstantSearch.js with Algolia credentials
const search = instantsearch({
  appId: 'AZI2EKWO49',
  apiKey: 'af40085957e518d9a9f4b35cf22bb3ca',
  indexName: 'test_NAME',
  searchParameters: {
    restrictSearchableAttributes: [
      'title',
      'content'
    ]
  }
});

const hitTemplate = function(hit) {
  const url = hit.url;
  const title = hit._highlightResult.title.value;
  const content = hit._highlightResult.html.value;

  return `
    <div class="list__item">
      <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
        <h2 class="archive__item-title" itemprop="headline"><a href="${url}">${title}</a></h2>
        <div class="archive__item-excerpt" itemprop="description">${content}</div>
      </article>
    </div>
  `;
}

// Adding searchbar and results widgets
search.addWidget(
  instantsearch.widgets.searchBox({
    container: '.search-searchbar',
    poweredBy: true,
    placeholder: 'Enter your search term...'
  })
);
search.addWidget(
  instantsearch.widgets.hits({
    container: '.search-hits',
    templates: {
      item: hitTemplate,
      empty: 'No results',
    }
  })
);

// Starting the search only when toggle is clicked
$(document).ready(function () {
  $(".search__toggle").on("click", function() {
    if(!search.started) {
      search.start();
    }
  });
});
</script>








  </body>
</html>
